<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>APEX V24.3.0 - OMNI GHOST [LAYER 4: SOLANA-PULSE]</title>
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIkFQRVggR0hPU1QiLAogICJzaG9ydF9uYW1lIjogIkFQRVggR0hPU1QiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiIzAxMDIwNCIsCiAgInRoZW1lX2NvbG9yIjogIiMwMTAyMDQiLAogIClY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL2Nkbi1pY29ucy1wbmcuZmxhdGljb24uY29tLzUxMi8yNTg5LzI1ODkzMTMucG5nIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiCiAgICB9CiAgXQp9">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@800&family=Orbitron:wght@900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <style>
        :root { --bg: #020408; --neon: #14f195; --gold: #d4af37; --red: #ff003c; --green: #14f195; --purple: #9945ff; --blue-c: #00c2ff; }
        body { background: var(--bg); color: #e2e8f0; font-family: 'Inter', sans-serif; overflow: hidden; user-select: none; -webkit-tap-highlight-color: transparent; }
        .master-panel { background: rgba(2, 4, 8, 0.99); border: 2px solid var(--gold); border-radius: 4rem; box-shadow: 0 0 60px rgba(212, 175, 55, 0.2); }
        .input-god { background: rgba(255,255,255,0.03); border: 1px solid #1e293b; border-radius: 1.2rem; padding: 0.5rem 0.75rem; color: #fff; width: 100%; outline: none; font-weight: bold; font-size: 13px; transition: 0.3s; }
        .input-god:focus { border-color: var(--neon); background: rgba(20, 241, 149, 0.05); }
        #bet_panel { padding: 0.75rem 1.25rem; border-radius: 1.5rem; background: linear-gradient(to bottom right, #0d0f14, #000); border: 1px solid rgba(255,255,255,0.05); }
        #main_container { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; padding: 0 1.25rem; flex: 1; overflow: hidden; margin-top: 0.5rem; }
        #feed_signal, #feed_active { display: flex; flex-direction: column; gap: 0.6rem; overflow-y: auto; scrollbar-width: none; height: 100%; }
        #feed_signal::-webkit-scrollbar, #feed_active::-webkit-scrollbar { display: none; }
        .card-base { flex-shrink: 0 !important; min-height: 100px; padding: 0.8rem; border-radius: 1.5rem; transition: 0.4s; position: relative; overflow: hidden; }
        .standard-card { border: 1px solid rgba(20, 241, 149, 0.15); background: rgba(255,255,255,0.01); }
        .whale-card { border: 1px solid rgba(212, 175, 55, 0.8) !important; background: linear-gradient(145deg, #0d0f14, #251e0a) !important; box-shadow: 0 0 20px rgba(212, 175, 55, 0.25) !important; }
        .micin-card { border: 1px solid rgba(153, 69, 255, 0.4) !important; background: rgba(15, 23, 42, 0.6) !important; }
        .grade-a-card { border: 2px solid #d4af37 !important; background: linear-gradient(135deg, #1a1a10 0%, #000 100%) !important; box-shadow: inset 0 0 15px rgba(212, 175, 55, 0.1); }
        .grade-b-card { border: 2px solid #14f195 !important; background: linear-gradient(135deg, #0a1a0e 0%, #000 100%) !important; }
        .grade-c-card { border: 2px solid #9945ff !important; background: linear-gradient(135deg, #120a1a 0%, #000 100%) !important; }
        .trailing-active { border: 2px solid var(--gold) !important; box-shadow: 0 0 20px rgba(212, 175, 55, 0.3); }
        .dump-alert { border: 2px solid var(--red) !important; animation: shake 0.5s infinite; }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(5px); } 75% { transform: translateX(-5px); } }
        .pct-btn { border: 1px solid rgba(255,255,255,0.05); border-radius: 0.75rem; padding: 0.4rem; font-size: 10px; font-weight: 900; background: rgba(255,255,255,0.02); color: #64748b; transition: 0.2s; cursor: pointer; }
        .pct-active { background: var(--neon) !important; color: #000 !important; border-color: var(--neon); box-shadow: 0 0 15px var(--neon); }
        .radar-scan-anim { animation: scan_pulse 2s infinite linear; }
        @keyframes scan_pulse { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .ghost-clear { filter: none !important; transition: 0.4s; }
        .status-tag { font-size: 7px; font-weight: 900; text-transform: uppercase; padding: 0.1rem 0.4rem; border-radius: 9999px; border-width: 1px; }
        footer { background: rgba(2, 4, 8, 0.99); backdrop-blur: 15px; border-top: 1px solid rgba(255,255,255,0.05); border-radius: 1.5rem 1.5rem 0 0; height: 120px; padding: 0.75rem 1.25rem; display: grid; grid-template-columns: 1fr 140px; gap: 1rem; }
        #logs { height: 85px; background: rgba(0,0,0,0.4); border-radius: 0.75rem; padding: 0.5rem; border: 1px solid rgba(255,255,255,0.05); overflow-y: auto; scrollbar-width: none; font-family: monospace; font-size: 7px; color: rgba(20, 241, 149, 0.6); }
        #backtest_modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 10000; padding: 1.5rem; }
        .historis-container { background: #0d0f14; border: 1px solid var(--purple); border-radius: 2rem; height: 100%; overflow: hidden; display: flex; flex-direction: column; }
        #neural_clock { font-family: 'JetBrains Mono', monospace; font-size: 7px; font-weight: 900; color: var(--neon); letter-spacing: 1px; margin-top: 2px; text-shadow: 0 0 5px var(--neon); }
        .glitch-text { animation: glitch 1s linear infinite; }
        @keyframes glitch { 0% { text-shadow: 2px 0 var(--red), -2px 0 var(--purple); } 50% { text-shadow: -2px 0 var(--red), 2px 0 var(--purple); } 100% { text-shadow: 2px 0 var(--red), -2px 0 var(--purple); } }
        #pro_toast_container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 99999; width: 90%; max-width: 350px; pointer-events: none; }
        .pro-toast { background: rgba(2, 4, 8, 0.95); border-left: 4px solid var(--neon); padding: 15px 20px; border-radius: 1rem; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 10px 30px rgba(0,0,0,0.5); pointer-events: auto; }
        
        .tp2-hunting { animation: pulse-gold 1s infinite alternate; border: 2px solid var(--gold) !important; }
        @keyframes pulse-gold { from { box-shadow: 0 0 10px rgba(212, 175, 55, 0.2); } to { box-shadow: 0 0 25px rgba(212, 175, 55, 0.6); } }
        .clickable-card:active { transform: scale(0.95); opacity: 0.8; }

        .signal-locked { opacity: 0.3 !important; filter: grayscale(1) !important; pointer-events: none !important; }
        .locked-badge { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; background: rgba(0,0,0,0.7); z-index: 10; color: #ff003c; font-weight: 900; font-size: 10px; text-align: center; }

        #neural_confirm_modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-blur: 8px; z-index: 999999; align-items: center; justify-content: center; padding: 2rem; }
        .neural-modal-box { background: #020408; border: 1px solid var(--neon); border-radius: 2rem; padding: 2rem; width: 100%; max-width: 320px; text-align: center; box-shadow: 0 0 40px rgba(20, 241, 149, 0.2); }
        
        #popup_m_cold { height: 80px !important; text-align: center !important; }
        #popup_m_key { text-align: center !important; display: flex; align-items: center; justify-content: center; }
        .input-god::placeholder { text-align: center; }

        .trend-line-container { height: 25px; width: 100%; background: rgba(0,0,0,0.3); border-radius: 6px; overflow: hidden; margin-top: 6px; display: flex; align-items: flex-end; gap: 2px; padding: 2px; border: 1px solid rgba(255,255,255,0.05); }
        .trend-bar { flex: 1; background: var(--green); border-radius: 1px; transition: all 0.2s ease-in-out; }
        .trend-danger { background: var(--red) !important; box-shadow: 0 0 10px var(--red); animation: pulse 0.5s infinite; }

        .compound-active { border-color: var(--green) !important; box-shadow: 0 0 20px rgba(20, 241, 149, 0.2) !important; }
        .btn-disabled { opacity: 0.3; pointer-events: none !important; filter: grayscale(1); cursor: not-allowed; }
        .buffer-mode { color: #f59e0b !important; text-shadow: 0 0 5px #f59e0b; }
        .stamp-logic { position: absolute; bottom: 5px; right: 10px; font-size: 6px; font-weight: 900; color: rgba(212, 175, 55, 0.5); font-style: italic; text-transform: uppercase; }
        #manual_security_btn { border: 1px solid var(--neon); color: var(--neon); background: rgba(20, 241, 149, 0.05); }
        #manual_security_btn:hover { background: var(--neon); color: black; box-shadow: 0 0 15px var(--neon); }

        .buffer-blink-icon { animation: buffer-flash 1s infinite; color: #f59e0b; }
        @keyframes buffer-flash { 0% { opacity: 1; transform: scale(1.1); } 50% { opacity: 0.3; transform: scale(1.0); } 100% { opacity: 1; transform: scale(1.1); } }
        .msp-active-glow { color: #14f195 !important; text-shadow: 0 0 10px #14f195, 0 0 20px #14f195 !important; font-weight: 900 !important; border-color: #14f195 !important; background: rgba(20, 241, 149, 0.1) !important; }
        .blink-text-red-gold { animation: blink-rg 0.8s infinite; font-weight: 900; font-size: 7px; margin-left: 5px; }
        @keyframes blink-rg { 0% { color: #ff003c; opacity: 1; } 50% { color: #d4af37; opacity: 0.5; } 100% { color: #ff003c; opacity: 1; } }
        
        #popup_m_key, #popup_m_cold {
            word-break: break-all;
            white-space: pre-wrap;
            overflow-y: auto;
            font-family: 'JetBrains Mono', monospace;
            text-align: left !important;
            padding: 10px !important;
        }
        .pct-alloc-btn { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); padding: 5px; border-radius: 8px; font-size: 9px; font-weight: 900; color: #14f195; transition: 0.2s; }
        .pct-alloc-btn:active { transform: scale(0.9); background: #14f195; color: #000; }

        /* Logic Additions Styling */
        #buffer_countdown { font-family: 'JetBrains Mono', monospace; font-size: 6px; color: #f59e0b; margin-top: 2px; }

        /* Additional Logic Styling For Ledger */
        .ledger-stamp { font-size: 8px; font-weight: 900; padding: 2px 6px; border-radius: 4px; text-transform: uppercase; margin-right: 5px; }
        .stamp-sim { background: rgba(59, 130, 246, 0.2); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.5); }
        .stamp-real { background: rgba(20, 241, 149, 0.2); color: #14f195; border: 1px solid rgba(20, 241, 149, 0.5); }

        /* Progress Bar Master */
        .progress-container-master { width: 100%; height: 4px; background: rgba(255,255,255,0.05); border-radius: 2px; margin-top: 4px; overflow: hidden; }
        .progress-fill-buffer { height: 100%; background: linear-gradient(90deg, #f59e0b, #d4af37); box-shadow: 0 0 10px #f59e0b; transition: width 0.5s ease-in-out; }

        /* MASTER NEW STYLING FOR SNIPER & UI SYNC */
        .sniper-badge { position: absolute; bottom: 5px; right: 5px; background: #ff003c; color: white; font-size: 7px; font-weight: 900; padding: 2px 6px; border-radius: 4px; z-index: 20; box-shadow: 0 0 10px #ff003c; }
        .sniper-active-btn { background: #ff003c !important; color: white !important; box-shadow: 0 0 20px #ff003c !important; border-color: #ff003c !important; }
        #locked_initial_balance { font-size: 8px; font-weight: 900; color: var(--gold); background: rgba(212, 175, 55, 0.1); padding: 4px 8px; border-radius: 8px; border: 1px solid rgba(212, 175, 55, 0.3); }
        .blink-update { animation: blink-update-anim 0.5s infinite alternate; }
        @keyframes blink-update-anim { from { opacity: 1; background: #ca8a04; } to { opacity: 0.5; background: #eab308; } }
        
        /* SYNC ADDITION - LOCKED BALANCE DISPLAY */
        #locked_balance_box { font-size: 8px; font-weight: 900; color: #00c2ff; background: rgba(0, 194, 255, 0.1); padding: 4px 8px; border-radius: 8px; border: 1px solid rgba(0, 194, 255, 0.3); margin-right: 4px; display: none; }

        /* ANDROID OPTIMIZATION: CENTERED LAYOUT */
        .container-tight { max-width: 450px; margin: 0 auto; display: flex; flex-direction: column; height: 100vh; }
    </style>
</head>
<body class="h-screen flex flex-col">
    <div id="pro_toast_container"></div>

    <div class="container-tight">

    <div id="modal_alokasi_gate" class="hidden fixed inset-0 bg-black/95 backdrop-blur-md z-[30000] flex items-center justify-center p-6 animate__animated animate__fadeIn">
        <div class="master-panel w-full max-sm p-8 text-center border-green-500/50">
            <i class="fa-solid fa-vault text-4xl text-green-400 mb-4"></i>
            <h2 class="text-lg font-black text-white uppercase italic">Alokasi Modal Kerja</h2>
            <p id="label_real_balance" class="text-[10px] text-green-400 mb-4 uppercase tracking-widest font-black">[ Balance: 0.00 SOL ]</p>
            
            <div class="mb-6">
                <label class="text-[7px] font-black text-cyan-400 uppercase tracking-widest block mb-2">Pilih Persentase atau Input Manual (IDR)</label>
                <div class="grid grid-cols-4 gap-2 mb-4">
                    <button onclick="quickAlloc(0.25)" class="pct-alloc-btn">25%</button>
                    <button onclick="quickAlloc(0.50)" class="pct-alloc-btn">50%</button>
                    <button onclick="quickAlloc(0.75)" class="pct-alloc-btn">75%</button>
                    <button onclick="quickAlloc(1.00)" class="pct-alloc-btn">100%</button>
                </div>
                <input type="text" id="input_modal_virtual" oninput="syncFromIdrCustom('input_modal_virtual')" class="input-god text-center text-xl" placeholder="5.000.000">
                <p id="convert_preview_alloc" class="text-[8px] text-yellow-500 mt-2 font-black uppercase tracking-tighter">EST: 0.0000 SOL</p>
            </div>

            <div class="bg-white/5 p-4 rounded-2xl border border-white/10 mb-6 text-left">
                <p class="text-[7px] text-yellow-500 font-black uppercase italic">Master Logic Security:</p>
                <ul class="text-[8px] text-white/60 font-bold mt-1 uppercase space-y-1">
                    <li>• Compounding aktif setelah profit 100%.</li>
                    <li>• Saldo ditarik dari Solana Wallet Trade.</li>
                </ul>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="skipAllocation()" class="w-full bg-white/10 text-white/40 py-4 rounded-[2rem] font-black uppercase tracking-widest">Lewati</button>
                <button onclick="lockVirtualCapital()" class="w-full bg-green-600 text-white py-4 rounded-[2rem] font-black uppercase tracking-widest shadow-[0_0_20px_rgba(20,241,149,0.3)]">Mulai Trading</button>
            </div>
        </div>
    </div>

    <div id="neural_confirm_modal" class="animate__animated animate__fadeIn">
        <div class="neural-modal-box">
            <i class="fa-solid fa-triangle-exclamation text-3xl text-yellow-500 mb-4"></i>
            <h3 id="n_modal_title" class="text-sm font-black text-white uppercase italic mb-2 tracking-widest">Master Confirmation</h3>
            <p id="n_modal_msg" class="text-[10px] text-white/60 mb-6 font-bold uppercase"></p>
            <div class="grid grid-cols-2 gap-3">
                <button onclick="closeNeuralModal(false)" class="py-3 rounded-xl border border-white/10 text-[9px] font-black text-white/40 uppercase tracking-widest">Abort</button>
                <button onclick="closeNeuralModal(true)" class="py-3 rounded-xl bg-cyan-600 text-white text-[9px] font-black uppercase tracking-widest shadow-[0_0_15px_rgba(20,241,149,0.4)]">Execute</button>
            </div>
        </div>
    </div>

    <div id="real_auth_modal" class="hidden fixed inset-0 bg-black/95 backdrop-blur-md z-[20000] flex items-center justify-center p-6 animate__animated animate__fadeIn">
        <div class="master-panel w-full max-md p-8 relative border-cyan-500/50 shadow-[0_0_50px_rgba(20,241,149,0.15)]">
            <button onclick="cancelRealMode()" class="absolute top-6 right-6 text-white/30 hover:text-white transition-all">
                <i class="fa-solid fa-circle-xmark text-2xl"></i>
            </button>
            <div class="text-center mb-6">
                <i class="fa-solid fa-link text-4xl text-cyan-400 mb-2"></i>
                <h2 class="text-lg font-black tracking-widest text-white uppercase italic">Phantom Neural Link</h2>
                <p class="text-[8px] text-cyan-500/60 font-bold uppercase tracking-[2px]">Layer 4 Solana Private Key Required</p>
            </div>
            <div class="space-y-5">
                <div>
                    <label class="text-[7px] font-black text-cyan-400 uppercase tracking-widest ml-2 mb-1 block">Solana Wallet Vault</label>
                    <textarea id="popup_m_key" class="input-god h-16 text-[10px] text-left border-cyan-500/20" placeholder="All Solana Wallet Address Not from the Wallet Trade Private Key"></textarea>
                </div>
                <div>
                    <label class="text-[7px] font-black text-yellow-500 uppercase tracking-widest ml-2 mb-1 block">Solana Wallet Trade</label>
                    <textarea id="popup_m_cold" class="input-god h-24 text-[10px] text-left border-yellow-500/20" placeholder="Private Key Phantom/Jupiter Not From Solana Address Vault"></textarea>
                </div>
                <button id="establish_btn" onclick="confirmRealMode()" class="w-full bg-cyan-600 hover:bg-cyan-500 text-white py-4 rounded-[2rem] font-black uppercase tracking-widest shadow-[0_0_20px_rgba(20,241,149,0.4)] transition-all active:scale-95">
                    Connect to Raydium LP
                </button>
            </div>
        </div>
    </div>

    <div id="gate" class="fixed inset-0 bg-black flex items-center justify-center p-6 z-[9999]">
        <div class="master-panel w-full max-w-md p-10 text-center animate__animated animate__fadeIn">
            <div id="step1">
                <i class="fa-solid fa-crown text-6xl text-[#d4af37] mb-6"></i>
                <h1 class="text-2xl font-black tracking-[0.2em] text-[#d4af37] mb-4 uppercase">Ghost Admin</h1>
                <div class="flex flex-col gap-4">
                    <button onclick="verifyAdmin(true)" class="w-full bg-white/5 border border-cyan-500/50 text-cyan-400 p-5 rounded-[2rem] font-bold flex items-center justify-center gap-4 active:scale-95 transition-all">
                        <i class="fa-solid fa-fingerprint text-2xl"></i> BIOMETRIC
                    </button>
                    <input type="password" id="m_pin" class="input-god text-2xl tracking-[10px] text-center" placeholder="****">
                    <button onclick="verifyAdmin()" class="w-full bg-[#d4af37] text-black p-5 rounded-[2rem] font-bold uppercase active:scale-95 transition-all">Authorize</button>
                </div>
            </div>
        </div>
    </div>

    <div id="app" class="hidden flex flex-col h-screen">
        <nav class="flex justify-between items-center border-b border-white/5 bg-black/40 backdrop-blur-md px-6 py-2">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full border border-cyan-500 flex items-center justify-center"><i class="fa-solid fa-bolt text-cyan-400 text-sm"></i></div>
                <div class="leading-none">
                    <h2 class="text-[9px] font-black text-white italic tracking-tighter uppercase mb-0.5 glitch-text">Apex_Solana_Ghost_V24</h2>
                    <div id="neural_clock">SYNCING SOLANA...</div>
                    <div id="neural_date" class="text-[6px] text-white/40 font-bold uppercase tracking-widest mt-0.5">26 FEBRUARY 2026</div>
                    <span id="failover_status" class="text-[6px] text-green-400 font-bold uppercase tracking-widest">LAYER 4: ACTIVE</span>
                </div>
            </div>
            <div class="flex items-center gap-4">
                <div class="text-right leading-none">
                    <p id="m_bal" class="text-lg font-black text-white italic ghost-clear">0.00 SOL</p>
                    <p id="m_bal_idr" class="text-[7px] text-green-400 font-bold mt-0.5 text-right">RP 0</p>
                </div>
                <button onclick="location.reload()" class="w-8 h-8 flex items-center justify-center rounded-full bg-red-500/10 border border-red-500/50 text-red-500 active:scale-90 transition-all"><i class="fa-solid fa-right-from-bracket text-sm"></i></button>
            </div>
        </nav>

        <div class="px-6 mt-2">
            <div id="bet_panel">
                <div class="flex justify-between items-start mb-2">
                    <div class="leading-none">
                        <p class="text-[7px] font-black text-cyan-400 uppercase tracking-widest mb-1">Vault Balance</p>
                        <h3 id="vault_total" class="text-sm font-black text-white italic">0.00 SOL</h3>
                        <p id="vault_idr_main" class="text-[7px] text-green-400 font-bold mt-1">GHOST VAULT (RP 0)</p>
                    </div>
                    <div class="flex flex-col items-end gap-1">
                        <div id="buffer_icon_container" class="mb-1 flex flex-col items-end">
                            <div class="flex items-center">
                                <div id="locked_balance_box">LOCKED: 0.00 SOL</div>
                                <div id="locked_initial_balance" class="mb-1">CAPITAL: 0.00 SOL (RP 0)</div>
                            </div>
                            <div class="flex items-center">
                                <i class="fa-solid fa-shield-virus buffer-blink-icon"></i>
                                <span id="buffer_mode_status_tag" class="blink-text-red-gold uppercase">BUFFER ACTIVE (30D)</span>
                            </div>
                            <div class="progress-container-master"><div id="buffer_master_fill" class="progress-fill-buffer" style="width: 0%"></div></div>
                            <div id="buffer_countdown">Siklus: 00:00:00</div>
                        </div>
                        <p id="mode_tag" class="status-tag text-purple-400 bg-purple-500/10 border-purple-500/30">SIMULATION</p>
                        <button onclick="toggleMode()" id="switch_btn" class="text-[7px] font-black text-white bg-white/5 px-2 py-1 rounded-md border border-white/10 uppercase">Switch</button>
                    </div>
                </div>
                <div class="grid grid-cols-1 gap-2 mb-2">
                    <div class="relative">
                        <input type="text" id="input_idr" oninput="syncFromIdr()" class="input-god text-left" placeholder="Entry Amount (IDR)">
                        <span class="absolute right-3 top-2.5 text-[8px] text-green-500 font-black italic">IDR</span>
                        <div id="compound_indicator" class="hidden absolute left-3 top-2.5 text-[8px] text-green-400 font-black uppercase flex items-center gap-1"><i class="fa-solid fa-recycle animate-spin"></i> Auto-Comp</div>
                    </div>
                    <p id="convert_preview_main" class="text-[8px] text-white/40 font-black uppercase tracking-widest ml-2">Convert: 0.0000 SOL</p>
                </div>
                <div class="flex justify-between items-center px-1">
                    <div class="grid grid-cols-4 gap-1 w-2/3">
                        <button id="btn_25" onclick="applyPct(0.25, this)" class="pct-btn">25%</button>
                        <button id="btn_50" onclick="applyPct(0.50, this)" class="pct-btn">50%</button>
                        <button id="btn_75" onclick="applyPct(0.75, this)" class="pct-btn">75%</button>
                        <button id="btn_100" onclick="applyPct(1.00, this)" class="pct-btn">100%</button>
                    </div>
                    <button onclick="toggleSniper()" id="sniper_btn" class="pct-btn w-10 border-red-500/30 text-red-500"><i class="fa-solid fa-crosshairs"></i></button>
                    <p id="kurs_text" class="text-[7px] text-yellow-500 font-black uppercase">SOLANA LIVE</p>
                </div>
                <div class="mt-2 bg-white/5 rounded-full h-1.5 overflow-hidden border border-white/10"><div id="target_progress" class="bg-green-500 h-full transition-all duration-500" style="width: 0%"></div></div>
                <div class="flex justify-between mt-1"><span class="text-[6px] text-white/40 uppercase">Daily Progress</span><span id="target_stat" class="text-[6px] text-green-400 font-bold uppercase">0.00% / 25.00%</span></div>
                
                <button id="manual_security_btn" onclick="secureToVault()" class="w-full mt-2 py-2 bg-white/5 border border-white/10 rounded-lg text-[8px] font-black text-white/40 uppercase hover:text-cyan-400 transition-all italic">Manual Security Profit (Non Active)</button>
            </div>
        </div>

        <div id="main_container">
            <div class="flex flex-col h-full overflow-hidden">
                <div class="text-[8px] text-cyan-400 font-black uppercase tracking-[2px] mb-2 px-1 flex items-center gap-2 italic"><i class="fa-solid fa-dna animate-pulse"></i> Raydium Signals</div>
                <div id="feed_signal" class="pr-2"></div>
            </div>
            <div class="flex flex-col h-full overflow-hidden">
                <div class="text-[8px] text-yellow-500 font-black uppercase tracking-[2px] mb-2 px-1 flex items-center gap-2 italic"><i class="fa-solid fa-skull-crossbones"></i> Ghost Positions</div>
                <button onclick="panicSellAll()" class="text-[6px] font-black text-red-500 border border-red-500/20 bg-red-500/5 py-1 mb-2 rounded-full uppercase italic hover:bg-red-500 hover:text-white transition-all">Panic Sell All</button>
                <div id="feed_active" class="pr-2"></div>
            </div>
        </div>

        <footer>
            <div class="flex flex-col relative">
                <div class="text-[8px] text-purple-400 font-black uppercase tracking-[2px] mb-1 italic"><i class="fa-solid fa-code"></i> Solana Logs</div>
                <div id="logs"></div>
            </div>
            <div class="flex items-center justify-around bg-white/5 rounded-[2rem] border border-white/10 p-1">
                <button onclick="openBacktest()" class="flex flex-col items-center group px-4">
                    <i class="fa-solid fa-history text-purple-500 text-xl group-active:scale-90 transition-all"></i>
                    <span class="text-[7px] font-black text-purple-400 uppercase mt-1">History</span>
                </button>
                <div class="w-[1px] h-8 bg-white/10"></div>
                <button onclick="manualScan()" class="text-cyan-400 flex flex-col items-center group px-4">
                    <i id="radar_icon" class="fa-solid fa-compass radar-scan-anim mb-1 transition-all text-2xl"></i>
                    <span class="text-[7px] font-black uppercase tracking-widest">Pulse</span>
                </button>
            </div>
        </footer>
    </div>

    <div id="backtest_modal" class="animate__animated animate__fadeIn">
        <div class="historis-container p-5">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-3">
                    <i class="fa-solid fa-cubes text-purple-500 text-xl"></i>
                    <div>
                        <h2 id="bt_title" class="text-sm font-black italic text-white uppercase tracking-widest leading-none">Activity Ledger</h2>
                        <span id="bt_mode_display" class="text-[7px] text-purple-400 font-bold uppercase tracking-widest">SOLANA MAINNET</span>
                    </div>
                </div>
                <button onclick="closeBacktest()" class="text-white/40 hover:text-white"><i class="fa-solid fa-xmark text-2xl"></i></button>
            </div>
            <div id="backtest_stats" class="grid grid-cols-3 gap-2 mb-4">
                <div class="bg-white/5 p-3 rounded-2xl border border-white/10 text-center">
                    <p class="text-[6px] text-white/40 uppercase font-bold mb-1">Total Signals</p>
                    <p id="bt_total" class="text-sm font-black text-cyan-400">0</p>
                </div>
                <div class="bg-white/5 p-3 rounded-2xl border border-white/10 text-center">
                    <p id="win_rate_label" class="text-[6px] text-white/40 uppercase font-bold mb-1">Target Gain</p>
                    <p id="bt_winrate" class="text-sm font-black text-green-400">0.00% / 25%</p>
                </div>
                <div class="bg-white/5 p-3 rounded-2xl border border-white/10 text-center flex flex-col items-center justify-center">
                    <p class="text-[6px] text-white/40 uppercase font-bold mb-1">Net Gain (SOL)</p>
                    <p id="bt_profit" class="text-[10px] font-black text-yellow-500 leading-none">0.000000</p>
                    <p id="bt_profit_idr" class="text-[5px] text-green-400 font-black mt-1">RP 0</p>
                </div>
            </div>
            <div id="backtest_list" class="flex-1 overflow-y-auto pr-1 space-y-2 scrollbar-hide"></div>
            
            <div class="grid grid-cols-2 gap-2 mt-4">
                <button onclick="downloadMonthlyExcel()" class="bg-green-600 text-white py-3 rounded-xl font-black text-[9px] uppercase tracking-widest active:scale-95 transition-all">
                    <i class="fa-solid fa-file-csv mr-1"></i> Export
                </button>
                
                <button id="daily_update_btn" onclick="performDailyReset()" class="bg-yellow-600 text-black py-3 rounded-xl font-black text-[9px] uppercase tracking-widest active:scale-95 transition-all btn-disabled">
                    <i class="fa-solid fa-calendar-check mr-1"></i> Withdraw to Vault
                </button>
            </div>

            <button onclick="refreshHistory()" id="bt_run_btn" class="w-full bg-purple-600 text-white py-3 rounded-[1.2rem] font-black text-[10px] uppercase tracking-widest mt-2 active:scale-95 transition-all">Sync Blockchain</button>
        </div>
    </div>

    </div> <script>
        const M_PIN = "081241955337";
        const MODAL_DASAR = 100 * 2500000; // SIMULATION 100 SOL FIX
        let KURS_SOL_IDR = 2500000; 
        
        const HELIUS_RPC_POOL = [
            "https://mainnet.helius-rpc.com/?api-key=4339979a-d0e5-482d-892f-a0b7a1524285",
            "https://mainnet.helius-rpc.com/?api-key=17d8a69a-99a7-498d-beff-a58a7a06196a", 
            "https://mainnet.helius-rpc.com/?api-key=9f32c57d-0531-467e-97dc-9cb8cbed4c36",
            "https://mainnet.helius-rpc.com/?api-key=6d4c982f-4d3f-4920-9ee3-daf77c0a40cf",
            "https://mainnet.helius-rpc.com/?api-key=2081f105-7077-476d-bf08-71ea2381741c",
            "https://mainnet.helius-rpc.com/?api-key=2f2dac10-4a6c-4b57-991a-129b86b1fbf5",
            "https://mainnet.helius-rpc.com/?api-key=c74f9c64-a6a8-4333-bded-f2af446088fc",
            "https://mainnet.helius-rpc.com/?api-key=88539fa4-b695-4f01-aa34-5024d6df0a56"
        ];
        let currentRpcIdx = 0;

        async function getSolanaConnection() {
            for (let i = 0; i < HELIUS_RPC_POOL.length; i++) {
                const url = HELIUS_RPC_POOL[currentRpcIdx];
                try {
                    const conn = new solanaWeb3.Connection(url, 'confirmed');
                    await conn.getSlot(); 
                    document.getElementById('failover_status').innerText = `LAYER 4: HELIUS-${currentRpcIdx + 1}`;
                    return conn;
                } catch (e) {
                    currentRpcIdx = (currentRpcIdx + 1) % HELIUS_RPC_POOL.length;
                    addLog("RPC", "SWITCHING_PATHWAY...");
                }
            }
            return null;
        }

        const PROXY_PIPELINE = [
            "https://corsproxy.io/?",
            "https://api.allorigins.win/raw?url=",
            "https://thingproxy.freeboard.io/fetch/",
            "https://api.codetabs.com/v1/proxy?quest="
        ];
        let currentPipelineIdx = 0;

        const PATEN_STRATEGY = {
            "STRICT A+": { allocation: 0.50, sub_pct: 1.0, tp: 2.0, tp2: 5.0, sl: -0.8, trailing: 0.3, dump_shield: -0.6, priority: 3 },
            "AGGRESSIVE B+": { allocation: 0.25, sub_pct: 0.5, tp: 4.5, tp2: 10.0, sl: -1.5, trailing: 1.0, dump_shield: -1.0, priority: 2 },
            "GRADE C+": { allocation: 0.25, sub_pct: 0.1, tp: 5.0, tp2: 15.0, sl: -3.0, trailing: 2.0, dump_shield: -2.0, priority: 1 }
        };

        let SIM_BAL = parseFloat(localStorage.getItem('apex_sim_bal')) || MODAL_DASAR;
        let TOTAL_SECURED_SIM = parseFloat(localStorage.getItem('apex_sim_vault')) || 0;
        let ACTIVE_CARDS_DATA = JSON.parse(localStorage.getItem('apex_active_cards')) || {};

        let IS_REAL = false, REAL_BAL = 0, TOTAL_SECURED_REAL = 0;
        let API_KEY = "", SECRET_KEY = "";
        let START_BAL_DAY = parseFloat(localStorage.getItem('apex_start_bal')) || 0; 
        let TARGET_PERCENT = 0.25;
        let SIM_HISTORY = JSON.parse(localStorage.getItem('apex_sim_history_idx')) || [];
        
        let ACTIVE_INTERVALS = {};
        let TREND_HISTORY = {}; 

        let IS_AUTO_COMPOUND = false; // Sniper logic overrides this
        let LAST_CHECKED_DATE = localStorage.getItem('apex_last_date') || new Date().toLocaleDateString();
        let IS_VAULTED_TODAY = localStorage.getItem('apex_is_vaulted') === 'true';
        let ALLOCATED_CAPITAL = parseFloat(localStorage.getItem('apex_allocated_cap')) || 0;

        // Logic Additions Variables
        let BUFFER_ACTIVE_STATUS = localStorage.getItem('apex_buffer_active') === 'true';
        let LAST_BUFFER_CYCLE = parseInt(localStorage.getItem('apex_last_buffer_cycle')) || Date.now();
        let MSP_USED_IN_CYCLE = localStorage.getItem('apex_msp_used') === 'true';
        
        // NEW MASTER LOGIC VARS
        let IS_SNIPER_ACTIVE = false;

        let modalResolve = null;

        async function updateSolanaPrice() {
            try {
                const res = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=solana&vs_currencies=idr");
                const data = await res.json();
                if (data.solana && data.solana.idr) {
                    KURS_SOL_IDR = data.solana.idr;
                    document.getElementById('kurs_text').innerText = `SOL: RP ${formatVisualIDR(KURS_SOL_IDR)}`;
                    updateUI();
                }
            } catch (e) { console.log("Price fetch delay..."); }
        }
        setInterval(updateSolanaPrice, 30000);
        updateSolanaPrice();

        function openNeuralModal(msg) {
            document.getElementById('n_modal_title').innerText = "Master Confirmation";
            document.getElementById('n_modal_msg').innerText = msg;
            document.getElementById('neural_confirm_modal').style.display = 'flex';
            return new Promise(resolve => { modalResolve = resolve; });
        }
        function closeNeuralModal(confirmed) {
            document.getElementById('neural_confirm_modal').style.display = 'none';
            if(modalResolve) modalResolve(confirmed);
        }

        function quickAlloc(pct) {
            const b = IS_REAL ? REAL_BAL : MODAL_DASAR;
            const amt = b * pct;
            document.getElementById('input_modal_virtual').value = formatVisualIDR(amt);
            syncFromIdrCustom('input_modal_virtual');
        }

        async function syncSimulationWithReal(isBecomingReal) {
            document.getElementById('feed_active').innerHTML = "";
            ACTIVE_CARDS_DATA = {};
            localStorage.setItem('apex_active_cards', JSON.stringify({}));
            
            if(isBecomingReal) {
                try {
                    const conn = await getSolanaConnection();
                    if(conn && API_KEY) {
                        const pubKey = new solanaWeb3.PublicKey(API_KEY);
                        const lamports = await conn.getBalance(pubKey);
                        REAL_BAL = (lamports / solanaWeb3.LAMPORTS_PER_SOL) * KURS_SOL_IDR;
                    }
                } catch(e) { 
                    addLog("ERR", "RPC_BALANCE_FETCH_FAILED");
                    REAL_BAL = 0; 
                }
                START_BAL_DAY = REAL_BAL;
                localStorage.setItem('apex_start_bal', START_BAL_DAY);
                addLog("SYNC", "REAL_WALLET_LINKED_SUCCESS");
            } else {
                SIM_BAL = MODAL_DASAR;
                START_BAL_DAY = SIM_BAL;
                localStorage.setItem('apex_start_bal', START_BAL_DAY);
                localStorage.setItem('apex_sim_bal', SIM_BAL);
                addLog("SYNC", "DECOUPLING_TO_SIMULATION (100 SOL)");
            }
            checkDailyTarget();
            updateUI();
        }

        function toggleSniper() {
            IS_SNIPER_ACTIVE = !IS_SNIPER_ACTIVE;
            const btn = document.getElementById('sniper_btn');
            
            if(IS_SNIPER_ACTIVE) {
                btn.classList.add('sniper-active-btn');
                document.querySelectorAll('.pct-btn').forEach(b => {
                    if(b.id !== 'sniper_btn') b.classList.add('btn-disabled');
                });
                document.getElementById('input_idr').disabled = true;
                proAlert("SNIPER MODE: ENGAGED (10% ALLOC)", "success");
            } else {
                btn.classList.remove('sniper-active-btn');
                document.querySelectorAll('.pct-btn').forEach(b => b.classList.remove('btn-disabled'));
                document.getElementById('input_idr').disabled = false;
                proAlert("SNIPER MODE: DISENGAGED", "err");
            }
            updateUI();
        }

        async function verifyAdmin(b = false) { 
            if (b && window.PublicKeyCredential) {
                try {
                    addLog("BIO", "POLLING_SENSOR");
                    const challenge = new Uint8Array(32); window.crypto.getRandomValues(challenge);
                    const options = { publicKey: { challenge, rp: { name: "APEX_GHOST" }, user: { id: Uint8Array.from("Master", c => c.charCodeAt(0)), name: "Master", displayName: "Master" }, pubKeyCredParams: [{ alg: -7, type: "public-key" }], authenticatorSelection: { userVerification: "required", authenticatorAttachment: "platform" }, timeout: 60000 } };
                    const credential = await navigator.credentials.create(options);
                    if (credential) { addLog("SUCCESS", "BIO_CONFIRMED"); ignite(); }
                } catch (err) { addLog("ERR", "BIO_REJECTED"); }
            } else if (document.getElementById('m_pin').value === M_PIN) { 
                ignite(); 
            } else { proAlert("Access Denied.", "err"); }
        }

        async function ignite() {
            document.getElementById('gate').style.display = 'none'; 
            document.getElementById('app').classList.remove('hidden');
            updateNeuralClock();
            updateUI();
            Object.keys(ACTIVE_CARDS_DATA).forEach(id => {
                const data = ACTIVE_CARDS_DATA[id];
                injectActiveCard(id, data.sym, data.grade, data.cost, data.stampType || "GHOST_LOGIC");
                startGhostEngine(id, data.sym, data.cost, data.grade, data.real, data.roi);
            });
            setInterval(autoScanSolana, 4000); 
            autoScanSolana();
            refreshHistory();
            addLog("SYSTEM", "ENGINE_IGNITED_SOLANA_L4");
            setInterval(neuralChronosWatcher, 1000);
            if(!IS_REAL) { triggerVirtualModal(); }
        }

        function triggerVirtualModal() {
            const gate = document.getElementById('modal_alokasi_gate');
            const balLabel = document.getElementById('label_real_balance');
            const currentBal = IS_REAL ? REAL_BAL : MODAL_DASAR;
            balLabel.innerText = `[ Balance: ${(currentBal/KURS_SOL_IDR).toFixed(4)} SOL ]`;
            gate.classList.remove('hidden');
        }

        function skipAllocation() {
            if (ALLOCATED_CAPITAL > 0) { document.getElementById('modal_alokasi_gate').classList.add('hidden'); }
            else { proAlert("LOCK ALLOCATION FIRST", "err"); }
        }

        function lockVirtualCapital() {
            const inputStr = document.getElementById('input_modal_virtual').value.replace(/\D/g, "");
            const inputVal = parseInt(inputStr) || 0;
            const currentBalance = IS_REAL ? REAL_BAL : MODAL_DASAR;
            if (inputVal < 500000 || inputVal > (currentBalance * 2)) { proAlert("Input Tidak Valid", "err"); return; }
            if (inputVal > currentBalance) { proAlert("Saldo Trade Tidak Mencukupi!", "err"); return; }
            ALLOCATED_CAPITAL = inputVal;
            localStorage.setItem('apex_allocated_cap', ALLOCATED_CAPITAL);
            if (!IS_REAL) { SIM_BAL = inputVal; localStorage.setItem('apex_sim_bal', SIM_BAL); }
            START_BAL_DAY = inputVal; 
            localStorage.setItem('apex_start_bal', START_BAL_DAY);
            BUFFER_ACTIVE_STATUS = true;
            MSP_USED_IN_CYCLE = false;
            LAST_BUFFER_CYCLE = Date.now();
            localStorage.setItem('apex_buffer_active', true);
            localStorage.setItem('apex_msp_used', false);
            localStorage.setItem('apex_last_buffer_cycle', LAST_BUFFER_CYCLE);
            document.getElementById('modal_alokasi_gate').classList.add('hidden');
            addLog("SYSTEM", `SOL_ALLOCATION_LOCKED: ${(ALLOCATED_CAPITAL/KURS_SOL_IDR).toFixed(4)} SOL`);
            proAlert(`DANA TERKUNCI: ${formatVisualIDR(ALLOCATED_CAPITAL)}`, "success");
            updateUI();
        }

        async function manualScan() {
            addLog("SYSTEM", "PULSE_SCAN_TRIGGERED");
            document.getElementById('radar_icon').classList.add('animate-spin');
            await autoScanSolana(true);
            setTimeout(() => document.getElementById('radar_icon').classList.remove('animate-spin'), 2000);
        }

        async function autoScanSolana(force = false) {
            let success = false;
            let targetUrl = encodeURIComponent('https://api.dexscreener.com/latest/dex/tokens/So11111111111111111111111111111111111111112');
            for (let i = 0; i < PROXY_PIPELINE.length; i++) {
                if (success) break;
                let currentPath = PROXY_PIPELINE[currentPipelineIdx];
                try {
                    const res = await fetch(currentPath + targetUrl);
                    const result = await res.json();
                    if (result && result.pairs) {
                        processSolanaPairs(result.pairs, force); 
                        success = true;
                    }
                } catch (e) { 
                    currentPipelineIdx = (currentPipelineIdx + 1) % PROXY_PIPELINE.length;
                }
            }
        }

        function processSolanaPairs(pairs, force) {
            const isTargetMet = checkDailyTarget();
            pairs.forEach(p => {
                const sym = p.baseToken.symbol;
                const change = parseFloat(p.priceChange.h24 || 0);
                const vol = parseFloat(p.volume.h24 || 0);
                const id = p.pairAddress;
                if(!TREND_HISTORY[id]) TREND_HISTORY[id] = [];
                TREND_HISTORY[id].push(change);
                if(TREND_HISTORY[id].length > 10) TREND_HISTORY[id].shift();
                if (sym.toUpperCase() === "SOL" || sym.toUpperCase() === "WSOL") return;
                let passTier1 = change > 5.0; 
                let passTier2 = vol > 100000;
                if (passTier1 || passTier2 || force) {
                    let grade = change > 15 ? "STRICT A+" : (change > 8 ? "AGGRESSIVE B+" : "GRADE C+");
                    injectSignalSpecific(id, sym, p.priceUsd, grade, change, vol, isTargetMet);
                }
            });
        }

        function injectSignalSpecific(id, sym, price, grade, change, vol, isTargetMet) {
            const history = TREND_HISTORY[id] || [change];
            if(document.getElementById(`signal_${id}`)) {
                const existing = document.getElementById(`signal_${id}`);
                const trendBox = existing.querySelector('.trend-line-container');
                if(trendBox) {
                    trendBox.innerHTML = history.map((h, i) => {
                        const localFalling = i > 0 && history[i] < history[i-1];
                        return `<div class="trend-bar ${localFalling ? 'trend-danger' : ''}" style="height: ${Math.max(15, Math.min(100, Math.abs(h)*5))}%"></div>`;
                    }).join('');
                }
                const pctTag = existing.querySelector('.pct-value-tag');
                if(pctTag) pctTag.innerText = `+${change}%`;
                if(isTargetMet) existing.classList.add('signal-locked');
                const sniperBadge = existing.querySelector('.sniper-badge');
                if(IS_SNIPER_ACTIVE && !sniperBadge) {
                    const sb = document.createElement('div'); sb.className = 'sniper-badge'; sb.innerText = 'SNIPER 10%';
                    existing.appendChild(sb);
                } else if(!IS_SNIPER_ACTIVE && sniperBadge) {
                    sniperBadge.remove();
                }
                return;
            }
            const div = document.createElement('div'); div.id = `signal_${id}`;
            const gClass = grade.includes('A') ? 'grade-a-card' : (grade.includes('B') ? 'grade-b-card' : 'grade-c-card');
            div.className = `card-base mb-2 animate__animated animate__fadeInLeft ${gClass} ${isTargetMet ? 'signal-locked' : ''}`;
            div.innerHTML = `
                ${isTargetMet ? '<div class="locked-badge">TARGET REACHED</div>' : ''}
                <div style="position:absolute;top:0;right:0;background:#d4af37;color:black;font-size:8px;font-weight:900;padding:3px 12px;border-bottom-left-radius:12px;">${grade}</div>
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-[7px] text-green-400 font-black pct-value-tag">+${change}%</p>
                        <h3 class="text-sm font-black italic text-white">${sym}/SOL</h3>
                        <div class="trend-line-container">${history.map((h, i) => `<div class="trend-bar" style="height: ${Math.max(15, Math.min(100, Math.abs(h)*5))}%"></div>`).join('')}</div>
                    </div>
                </div>
                ${IS_SNIPER_ACTIVE ? '<div class="sniper-badge">SNIPER 10%</div>' : ''}
                <button onclick="handleStrike('${id}','${sym}',${price},'${grade}')" class="w-full bg-white/5 border border-white/10 py-2 mt-2 rounded-xl font-black text-[9px] text-white/60 uppercase strike-btn-logic">Strike</button>`;
            document.getElementById('feed_signal').appendChild(div);
            setTimeout(() => { if(document.getElementById(`signal_${id}`)) document.getElementById(`signal_${id}`).remove(); }, 30000);
        }

        function handleStrike(id, sym, price, grade) {
            if(checkDailyTarget()) { proAlert("TARGET MET: SIGNALS LOCKED", "err"); return; }
            let cost = 0; let stampType = "MANUAL_FIXED";
            const currentBal = IS_REAL ? REAL_BAL : SIM_BAL;
            if(IS_SNIPER_ACTIVE) { cost = currentBal * 0.10; stampType = "SNIPER 10%"; } 
            else {
                let costStr = document.getElementById('input_idr').value.replace(/\D/g, "");
                cost = parseInt(costStr) || 0;
                if(cost <= 0) {
                    const activePctBtn = document.querySelector('.pct-btn.pct-active');
                    if(!activePctBtn) { proAlert("INPUT AMOUNT OR ACTIVATE SNIPER", "err"); return; }
                }
            }
            if (cost > currentBal) { proAlert("Insufficient Balance", "err"); return; }
            const uniqueStrikeId = id + "_" + Date.now();
            injectActiveCard(uniqueStrikeId, sym, grade, cost, stampType);
            if(!IS_REAL) { SIM_BAL -= cost; localStorage.setItem('apex_sim_bal', SIM_BAL); } 
            else { REAL_BAL -= cost; }
            ACTIVE_CARDS_DATA[uniqueStrikeId] = { sym, grade, cost, real: IS_REAL, roi: 0, stampType };
            localStorage.setItem('apex_active_cards', JSON.stringify(ACTIVE_CARDS_DATA));
            startGhostEngine(uniqueStrikeId, sym, cost, grade, IS_REAL);
            updateUI();
        }

        function injectActiveCard(id, sym, grade, cost, stampType = "GHOST_LOGIC") {
            if(document.getElementById(`active_${id}`)) return;
            const div = document.createElement('div'); div.id = `active_${id}`;
            div.setAttribute('onclick', `manualVanish('${id}', '${sym}', ${cost}, '${grade}')`);
            div.className = `card-base mb-2 border-2 border-cyan-500 bg-[#0d0f14] animate__animated animate__pulse animate__infinite clickable-card relative`;
            div.innerHTML = `
                <div class="flex justify-between items-center"><span class="text-[7px] text-yellow-500 font-black">${grade}</span><span class="text-[6px] text-red-500 animate-pulse font-black">SOL-LIVE</span></div>
                <h3 class="text-[11px] font-black text-white italic">${sym}/SOL</h3>
                <div class="flex flex-col items-center py-2"><div id="roi_${id}" class="text-lg font-black text-cyan-400">0.00%</div><div id="roi_val_idr_${id}" class="text-[8px] font-bold text-white/60"> (+${((cost*0)/KURS_SOL_IDR).toFixed(4)} SOL)</div></div>
                <div class="trend-line-container mb-2" id="trend_strike_${id}"></div>
                <p class="text-[6px] text-white/40 text-center uppercase mb-1">Entry: ${(cost/KURS_SOL_IDR).toFixed(4)} SOL</p>
                <div class="sniper-badge" style="background:${stampType.includes('SNIPER')?'#ff003c':'#d4af37'}">${stampType}</div>`;
            document.getElementById('feed_active').prepend(div);
        }

        async function startGhostEngine(id, sym, cost, grade, real, startRoi = 0) {
            let roi = startRoi; let maxRoi = roi; 
            const config = PATEN_STRATEGY[grade] || { tp: 2.0, tp2: 5.0, l: -1.0, trailing: 0.5 };
            let localTrend = [0, 0.1, -0.1, 0];
            const iv = setInterval(() => {
                let change = (Math.random() * 1.5 - 0.6); roi += change; 
                if (roi > maxRoi) maxRoi = roi;
                localTrend.push(change);
                if(localTrend.length > 15) localTrend.shift();
                const rDisp = document.getElementById(`roi_${id}`);
                const rValDisp = document.getElementById(`roi_val_idr_${id}`);
                const trendDisp = document.getElementById(`trend_strike_${id}`);
                if(rDisp) {
                    rDisp.innerText = roi.toFixed(2) + "%";
                    rDisp.style.color = roi >= 0 ? "#14f195" : "#ff003c";
                    const profitIDR = Math.floor(cost * (roi / 100));
                    if(rValDisp) rValDisp.innerText = ` (${profitIDR >= 0 ? '+' : ''}${(profitIDR/KURS_SOL_IDR).toFixed(6)} SOL)`;
                    if(trendDisp) { trendDisp.innerHTML = localTrend.map(t => `<div class="trend-bar ${t < 0 ? 'trend-danger' : ''}" style="height: ${Math.max(20, Math.min(100, 50 + (t*50)))}%"></div>`).join(''); }
                }
                let shouldVanish = false;
                if (roi <= config.sl) shouldVanish = true;
                else if (roi >= config.tp) { if (maxRoi - roi >= config.trailing || roi >= config.tp2) shouldVanish = true; }
                if (shouldVanish) { clearInterval(iv); vanishEngine(id, sym, cost, roi, real, grade, "AUTO_SYSTEM"); }
            }, 1000);
            ACTIVE_INTERVALS[id] = iv;
        }

        async function manualVanish(id, sym, cost, grade) {
            const rDisp = document.getElementById(`roi_${id}`);
            if(!rDisp) return;
            const currentRoi = parseFloat(rDisp.innerText.replace('%', ''));
            const confirmed = await openNeuralModal(`Exit ${sym} at ${currentRoi}%?`);
            if(confirmed) {
                if(ACTIVE_INTERVALS[id]) clearInterval(ACTIVE_INTERVALS[id]);
                vanishEngine(id, sym, cost, currentRoi, IS_REAL, grade, "MANUAL_STRIKE");
            }
        }

        async function panicSellAll() {
            const activeCards = document.querySelectorAll('#feed_active > div');
            if(activeCards.length === 0) return;
            const confirmed = await openNeuralModal(`Liquidate ALL Solana positions?`);
            if(confirmed) {
                activeCards.forEach(card => {
                    const id = card.id.replace('active_', '');
                    const rDisp = document.getElementById(`roi_${id}`);
                    if(rDisp && ACTIVE_INTERVALS[id]) {
                        const currentRoi = parseFloat(rDisp.innerText.replace('%', ''));
                        clearInterval(ACTIVE_INTERVALS[id]);
                        vanishEngine(id, ACTIVE_CARDS_DATA[id].sym, ACTIVE_CARDS_DATA[id].cost, currentRoi, ACTIVE_CARDS_DATA[id].real, ACTIVE_CARDS_DATA[id].grade, "PANIC_SELL");
                    }
                });
            }
        }

        function vanishEngine(id, sym, cost, roi, real, grade, reason) {
            const profit = cost * (roi/100);
            if(!real) { SIM_BAL += (cost + profit); localStorage.setItem('apex_sim_bal', SIM_BAL); } 
            else { REAL_BAL += (cost + profit); }
            const historyEntry = { 
                date: new Date().toLocaleDateString(), time: new Date().toLocaleTimeString(), 
                sym, roi: roi.toFixed(2), net: profit, grade, mode: real ? 'REAL' : 'SIM',
                vaultAtTime: (real ? TOTAL_SECURED_REAL : TOTAL_SECURED_SIM),
                mainAtTime: (real ? REAL_BAL : SIM_BAL),
                stamp: ACTIVE_CARDS_DATA[id] ? ACTIVE_CARDS_DATA[id].stampType : "GHOST"
            };
            SIM_HISTORY.unshift(historyEntry);
            localStorage.setItem('apex_sim_history_idx', JSON.stringify(SIM_HISTORY));
            delete ACTIVE_CARDS_DATA[id];
            localStorage.setItem('apex_active_cards', JSON.stringify(ACTIVE_CARDS_DATA));
            if(document.getElementById(`active_${id}`)) document.getElementById(`active_${id}`).remove();
            updateUI(); refreshHistory();
            addLog("EXIT", `${sym} ${roi.toFixed(2)}% [${reason}]`);
        }

        function downloadMonthlyExcel() {
            if (SIM_HISTORY.length === 0) { proAlert("NO DATA TO EXPORT", "err"); return; }
            const currentModeFilter = IS_REAL ? 'REAL' : 'SIM';
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "DATE,TIME,PAIR,GRADE,MODE,ROI(%),PROFIT(SOL),VAULT_BALANCE(SOL),MAIN_BALANCE(SOL)\n";
            SIM_HISTORY.forEach(h => { 
                const solProfit = (h.net/KURS_SOL_IDR).toFixed(6);
                const solVault = (h.vaultAtTime/KURS_SOL_IDR).toFixed(4);
                const solMain = (h.mainAtTime/KURS_SOL_IDR).toFixed(4);
                csvContent += `${h.date},${h.time},${h.sym},${h.grade},${h.mode},${h.roi}%,${solProfit},${solVault},${solMain}\n`; 
            });
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `APEX_LEDGER_${currentModeFilter}_${new Date().toISOString().slice(0,10)}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        async function performDailyReset() {
            const totalAssetsNow = (IS_REAL ? REAL_BAL : SIM_BAL);
            const refBase = BUFFER_ACTIVE_STATUS ? ALLOCATED_CAPITAL : START_BAL_DAY;
            const netProfitIDR = totalAssetsNow - refBase;
            const actualPctGain = (netProfitIDR / refBase) * 100;
            if (BUFFER_ACTIVE_STATUS) {
                if (actualPctGain >= 100) {
                    const confirmed = await openNeuralModal("Siklus Buffer 100% Selesai. Amankan Modal ke Vault?");
                    if (confirmed) {
                        const amountToVault = ALLOCATED_CAPITAL;
                        if (!IS_REAL) { TOTAL_SECURED_SIM += amountToVault; SIM_BAL -= amountToVault; localStorage.setItem('apex_sim_vault', TOTAL_SECURED_SIM); } 
                        else { TOTAL_SECURED_REAL += amountToVault; REAL_BAL -= amountToVault; }
                        BUFFER_ACTIVE_STATUS = false;
                        localStorage.setItem('apex_buffer_active', false);
                        START_BAL_DAY = (IS_REAL ? REAL_BAL : SIM_BAL);
                        localStorage.setItem('apex_start_bal', START_BAL_DAY);
                        addLog("BUFFER", "PROFIT 100% SECURED - ENTERING COMPOUND MODE");
                        updateUI();
                    }
                } else if (actualPctGain >= 25) {
                    const confirmed = await openNeuralModal("Tarik Profit 25% Buffer ke Vault?");
                    if(confirmed) {
                         const profitOnly = netProfitIDR;
                         if(!IS_REAL) { TOTAL_SECURED_SIM += profitOnly; SIM_BAL -= profitOnly; } 
                         else { TOTAL_SECURED_REAL += profitOnly; REAL_BAL -= profitOnly; }
                         updateUI();
                    }
                }
                return;
            }
            if(actualPctGain < 25) { proAlert("TARGET 25% NOT REACHED", "err"); return; }
            const confirmed = await openNeuralModal("Target 25% Harian Tercapai. Tarik ke Vault?");
            if(!confirmed) {
                START_BAL_DAY = (IS_REAL ? REAL_BAL : SIM_BAL);
                localStorage.setItem('apex_start_bal', START_BAL_DAY);
                addLog("COMPOUND", "25% PROFIT ADDED TO CAPITAL");
                updateUI(); return;
            }
            const profitOnly = netProfitIDR;
            if(!IS_REAL) { TOTAL_SECURED_SIM += profitOnly; SIM_BAL -= profitOnly; localStorage.setItem('apex_sim_vault', TOTAL_SECURED_SIM); localStorage.setItem('apex_sim_bal', SIM_BAL); } 
            else { TOTAL_SECURED_REAL += profitOnly; REAL_BAL -= profitOnly; }
            START_BAL_DAY = (IS_REAL ? REAL_BAL : SIM_BAL); 
            localStorage.setItem('apex_start_bal', START_BAL_DAY);
            refreshHistory(); updateUI();
            addLog("SYSTEM", "DAILY_PROFIT_SECURED_TO_VAULT");
        }

        function neuralChronosWatcher() {
            const now = Date.now();
            const currentDateString = new Date().toLocaleDateString();
            if (currentDateString !== LAST_CHECKED_DATE) {
                LAST_CHECKED_DATE = currentDateString;
                localStorage.setItem('apex_last_date', LAST_CHECKED_DATE);
                if (!BUFFER_ACTIVE_STATUS) { START_BAL_DAY = IS_REAL ? REAL_BAL : SIM_BAL; localStorage.setItem('apex_start_bal', START_BAL_DAY); }
                addLog("SYSTEM", "NEW_BLOCKCHAIN_DAY");
            }
            if (now >= LAST_BUFFER_CYCLE + (30 * 24 * 60 * 60 * 1000)) {
                if (BUFFER_ACTIVE_STATUS) {
                    BUFFER_ACTIVE_STATUS = false;
                    localStorage.setItem('apex_buffer_active', false);
                    START_BAL_DAY = (IS_REAL ? REAL_BAL : SIM_BAL);
                    localStorage.setItem('apex_start_bal', START_BAL_DAY);
                    addLog("SYSTEM", "BUFFER CYCLE EXPIRED");
                }
                LAST_BUFFER_CYCLE = now;
                localStorage.setItem('apex_last_buffer_cycle', LAST_BUFFER_CYCLE);
            }
            if (BUFFER_ACTIVE_STATUS) {
                const timeLeft = (LAST_BUFFER_CYCLE + (30 * 24 * 60 * 60 * 1000)) - now;
                const days = Math.floor(timeLeft / (24 * 60 * 60 * 1000));
                const hrs = Math.floor((timeLeft % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));
                const mins = Math.floor((timeLeft % (60 * 60 * 1000)) / (60 * 1000));
                const secs = Math.floor((timeLeft % (60 * 1000)) / 1000);
                document.getElementById('buffer_countdown').innerText = `Reset: ${days}d ${hrs}:${mins}:${secs}`;
            } else { document.getElementById('buffer_countdown').innerText = "Compound: Unlimited"; }
        }

        function updateUI() { 
            const b = IS_REAL ? REAL_BAL : SIM_BAL; 
            const v = IS_REAL ? TOTAL_SECURED_REAL : TOTAL_SECURED_SIM;
            document.getElementById('m_bal').innerText = (b/KURS_SOL_IDR).toFixed(4) + " SOL"; 
            document.getElementById('m_bal_idr').innerText = "RP " + formatVisualIDR(b);
            document.getElementById('vault_total').innerText = (v/KURS_SOL_IDR).toFixed(4) + " SOL";
            document.getElementById('vault_idr_main').innerText = `GHOST VAULT (RP ${formatVisualIDR(v)})`;
            document.getElementById('mode_tag').innerText = IS_REAL ? "REAL MODE" : "SIMULATION";
            const lockedBox = document.getElementById('locked_balance_box');
            if(BUFFER_ACTIVE_STATUS) { lockedBox.style.display = "block"; lockedBox.innerText = `LOCKED: ${(ALLOCATED_CAPITAL/KURS_SOL_IDR).toFixed(4)} SOL`; } 
            else { lockedBox.style.display = "none"; }
            const refBase = BUFFER_ACTIVE_STATUS ? ALLOCATED_CAPITAL : START_BAL_DAY;
            const netProfitIDR = b - refBase;
            const actualPctGain = (netProfitIDR / refBase) * 100;
            const pctDisplay = actualPctGain.toFixed(2);
            document.getElementById('target_progress').style.width = Math.min(100, (actualPctGain / 25) * 100) + "%"; 
            document.getElementById('target_stat').innerText = `${pctDisplay}% / 25.00%`;
            const bufferPct = (netProfitIDR / ALLOCATED_CAPITAL) * 100;
            document.getElementById('buffer_master_fill').style.width = Math.min(100, Math.max(0, bufferPct)) + "%";
            const updateBtn = document.getElementById('daily_update_btn');
            const activeCount = Object.keys(ACTIVE_CARDS_DATA).length;
            if (actualPctGain >= 25 && activeCount === 0) { updateBtn.classList.remove('btn-disabled'); updateBtn.classList.add('blink-update'); } 
            else { updateBtn.classList.add('btn-disabled'); updateBtn.classList.remove('blink-update'); }
            const manualSecBtn = document.getElementById('manual_security_btn');
            const bufferStatusTag = document.getElementById('buffer_mode_status_tag');
            if (BUFFER_ACTIVE_STATUS) {
                bufferStatusTag.innerText = "BUFFER ACTIVE (30D)";
                bufferStatusTag.classList.remove('buffer-mode');
                manualSecBtn.classList.add('btn-disabled');
                manualSecBtn.innerText = "Security Profit (Locked in Buffer)";
            } else {
                bufferStatusTag.innerText = "BUFFER MODE (COMPOUND)";
                bufferStatusTag.classList.add('buffer-mode');
                if(!MSP_USED_IN_CYCLE && bufferPct >= 100) { manualSecBtn.classList.remove('btn-disabled'); manualSecBtn.classList.add('msp-active-glow'); manualSecBtn.innerText = "Manual Security Profit (Active)"; } 
                else { manualSecBtn.classList.add('btn-disabled'); manualSecBtn.innerText = MSP_USED_IN_CYCLE ? "Profit Moved to Vault" : "Security Profit (Locked < 100%)"; }
            }
        }

        function toggleMode() {
            if(!IS_REAL) { document.getElementById('real_auth_modal').classList.remove('hidden'); } 
            else { IS_REAL = false; REAL_BAL = 0; TOTAL_SECURED_REAL = 0; syncSimulationWithReal(false); }
        }

        async function confirmRealMode() {
            const key = document.getElementById('popup_m_key').value.trim();
            const secret = document.getElementById('popup_m_cold').value.trim();
            const btn = document.getElementById('establish_btn');
            if(!key || key.length < 32) { proAlert("INVALID VAULT ADDRESS", "err"); return; }
            if(!secret || secret.length < 64) { proAlert("INVALID TRADE PRIVATE KEY", "err"); return; }
            btn.innerText = "LINKING PHANTOM...";
            btn.classList.add('btn-disabled');
            try {
                API_KEY = key; SECRET_KEY = secret; 
                const conn = await getSolanaConnection();
                const pubKey = new solanaWeb3.PublicKey(key);
                const lamports = await conn.getBalance(pubKey);
                REAL_BAL = (lamports / solanaWeb3.LAMPORTS_PER_SOL) * KURS_SOL_IDR;
                cancelRealMode();
                IS_REAL = true; 
                syncSimulationWithReal(true);
                triggerVirtualModal();
                proAlert("PHANTOM LINKED: REAL MODE ACTIVE", "success");
            } catch (e) { proAlert("RPC CONNECTION FAILED", "err"); btn.innerText = "Connect to Raydium LP"; btn.classList.remove('btn-disabled'); }
        }

        function cancelRealMode() { document.getElementById('real_auth_modal').classList.add('hidden'); }
        function formatVisualIDR(v) { return new Intl.NumberFormat('id-ID').format(Math.floor(v)); }
        function syncFromIdr() { 
            let input = document.getElementById('input_idr');
            let v = input.value.replace(/\D/g, ""); 
            if(v !== "") { input.value = formatVisualIDR(v); document.getElementById('convert_preview_main').innerText = `Convert: ${(parseInt(v)/KURS_SOL_IDR).toFixed(6)} SOL`; }
        }
        function syncFromIdrCustom(id) {
            let input = document.getElementById(id);
            let v = input.value.replace(/\D/g, "");
            if(v !== "") { input.value = formatVisualIDR(v); document.getElementById('convert_preview_alloc').innerText = `EST: ${(parseInt(v)/KURS_SOL_IDR).toFixed(6)} SOL`; }
        }
        function applyPct(p, el) {
            if(IS_SNIPER_ACTIVE) return;
            const input = document.getElementById('input_idr');
            const b = ALLOCATED_CAPITAL || (IS_REAL ? REAL_BAL : SIM_BAL);
            document.querySelectorAll('.pct-btn').forEach(btn => btn.classList.remove('pct-active'));
            el.classList.add('pct-active');
            input.value = formatVisualIDR(b * p); syncFromIdr();
        }
        function addLog(t, m) { const l = document.getElementById('logs'); const d = document.createElement('div'); d.innerHTML = `<span class="text-cyan-400">[${t}]</span> ${m}`; l.prepend(d); }
        function proAlert(m, t) { 
            const c = document.getElementById('pro_toast_container'); const to = document.createElement('div');
            to.className = "pro-toast animate__animated animate__fadeInRight";
            to.innerHTML = `<i class="fa-solid ${t==='err'?'fa-circle-xmark text-red-500':'fa-circle-check text-cyan-400'}"></i><p class="text-[9px] font-bold text-white uppercase">${m}</p>`; 
            c.appendChild(to); setTimeout(() => to.remove(), 3000); 
        }
        function updateNeuralClock() { 
            setInterval(() => { 
                const d = new Date();
                document.getElementById('neural_clock').innerText = d.toLocaleTimeString('en-GB'); 
                document.getElementById('neural_date').innerText = d.toLocaleDateString('id-ID', {day:'2-digit', month:'long', year:'numeric'}).toUpperCase();
            }, 1000); 
        }
        function checkDailyTarget() { 
            const b = IS_REAL ? REAL_BAL : SIM_BAL;
            const refBase = BUFFER_ACTIVE_STATUS ? ALLOCATED_CAPITAL : START_BAL_DAY;
            const netProfitIDR = b - refBase;
            const actualPctGain = (netProfitIDR / refBase) * 100;
            return actualPctGain >= 25 && !BUFFER_ACTIVE_STATUS;
        }
        function refreshHistory() {
            const list = document.getElementById('backtest_list'); list.innerHTML = "";
            let netTotalIDR = 0; const currentModeKey = IS_REAL ? 'REAL' : 'SIM';
            const filteredHistory = SIM_HISTORY.filter(h => h.mode === currentModeKey);
            filteredHistory.forEach(h => {
                netTotalIDR += h.net; const c = document.createElement('div'); 
                const stampClass = h.mode === 'REAL' ? 'stamp-real' : 'stamp-sim';
                const stampLabel = h.mode === 'REAL' ? 'REAL' : 'SIMULASI';
                c.className = "bg-white/5 p-3 rounded-xl flex justify-between items-center mb-2 border border-white/5";
                c.innerHTML = `
                    <div style="flex: 1.2;"><span class="ledger-stamp ${stampClass}">${stampLabel}</span><p class="text-[10px] text-white font-bold inline">${h.sym}/SOL</p><p class="text-[6px] text-white/40 uppercase mt-1">${h.date} ${h.time}</p></div>
                    <div style="flex: 0.8; text-align: center;"><p class="text-[11px] ${h.roi>=0?'text-green-400':'text-red-500'} font-black">${h.roi}%</p></div>
                    <div style="flex: 1; text-align: right;"><p class="text-[8px] text-cyan-400">${(h.net/KURS_SOL_IDR).toFixed(6)} SOL</p><p class="text-[5px] text-white/20">RP ${formatVisualIDR(h.net)}</p></div>`;
                list.appendChild(c);
            });
            document.getElementById('bt_total').innerText = filteredHistory.length;
            document.getElementById('bt_profit').innerText = (netTotalIDR/KURS_SOL_IDR).toFixed(6);
            document.getElementById('bt_profit_idr').innerText = "RP " + formatVisualIDR(netTotalIDR);
            updateUI(); 
        }
        function openBacktest() { document.getElementById('backtest_modal').style.display = 'block'; refreshHistory(); }
        function closeBacktest() { document.getElementById('backtest_modal').style.display = 'none'; }
        async function secureToVault() {
            if(BUFFER_ACTIVE_STATUS) { proAlert("BUFFER ACTIVE: SECURITY LOCKED", "err"); return; }
            if(MSP_USED_IN_CYCLE) { proAlert("MSP ALREADY USED THIS CYCLE", "err"); return; }
            const b = IS_REAL ? REAL_BAL : SIM_BAL;
            const bufferRefBase = ALLOCATED_CAPITAL;
            const bufferNetProfit = b - bufferRefBase;
            if (bufferNetProfit < bufferRefBase) { proAlert("PROFIT 100% BELUM TERCAPAI", "err"); return; }
            const withdrawAmt = bufferNetProfit;
            const confirmed = await openNeuralModal(`Manual Security Profit: Amankan Profit ke Vault?`);
            if(confirmed) {
                if (IS_REAL) { TOTAL_SECURED_REAL += withdrawAmt; REAL_BAL -= withdrawAmt; } 
                else { TOTAL_SECURED_SIM += withdrawAmt; SIM_BAL -= withdrawAmt; localStorage.setItem('apex_sim_bal', SIM_BAL); localStorage.setItem('apex_sim_vault', TOTAL_SECURED_SIM); }
                MSP_USED_IN_CYCLE = true; localStorage.setItem('apex_msp_used', true);
                addLog("VAULT", `MANUAL SECURITY PROFIT: STORED TO VAULT`); updateUI(); 
            }
        }
    </script>
</body>
</html>
